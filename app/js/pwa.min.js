"use strict";console.log("hello world");const answer=await Notification.requestPermission();if(console.log(answer),"serviceWorker"in navigator)try{await navigator.serviceWorker.register("./serviceworker.js"),console.log("serviceWorker registered")}catch(e){console.log("serviceWorker registration failed",e)}else console.log("serviceWorker is not supported");const requestOptions={method:"GET",redirect:"follow"};function paginate(e){if(e>1){let t=document.createElement("button");t.innerHTML="Mehr laden",t.id="load_more_posts",t.dataset.totalPages=e,t.dataset.nextPage=2,t.addEventListener("click",(function(){fetch("https://api.s2010456022.student.kwmhgb.at/wp-json/wp/v2/kwm_cloth?per_page=3&page="+this.dataset.nextPage).then((e=>e.json())).then((e=>{renderPosts(e),t.dataset.nextPage++}))})),resources.append(t)}}function renderPosts(e){let t=document.getElementById("posts");for(let s of e){let e=document.createElement("div");e.classList.add("post"),e.dataset.resourceid=s.id,e.innerHTML=s.title.rendered,t.append(e)}}function setFrom(e){login_state.classList.remove("red"),login_state.classList.remove("green"),login_state.classList.add(e)}btn_fetch_cloths.addEventListener("click",(e=>{e.preventDefault(),fetch("https://api.s2010456022.student.kwmhgb.at/wp-json/wp/v2/kwm_cloth?per_page=3").then((function(e){return paginate(e.headers.get("X-WP-TotalPages")),e})).then((e=>e.json())).then((e=>renderPosts(e))),btn_fetch_cloths.style.display="none"})),window.localStorage.getItem("token")?(setFrom("green"),user_display_name.innerHTML="Willkommen zurück, "+window.localStorage.getItem("user_display_name"),console.log("Fetch token"),submit_post_form.classList.remove("hidden")):btn_login.addEventListener("click",(e=>{e.preventDefault(),submit_post_form.classList.add("hidden");const t={username:username.value,password:password.value};fetch("https://api.s2010456022.student.kwmhgb.at/wp-json/jwt-auth/v1/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>(200!==e.status&&(alert("Fehlgeschlagen: "+e.status),console.error(e),setFrom("red"),user_display_name.innerHTML=""),e))).then((e=>e.json())).then((e=>{console.log(e),window.localStorage.setItem("token",e.token),window.localStorage.setItem("user_display_name",e.user_display_name),submit_post_form.classList.remove("hidden"),setFrom("green"),user_display_name.innerHTML="Willkommen zurück, "+window.localStorage.getItem("user_display_name")})).catch((e=>console.log("Error: ",e)))})),btn_logout.addEventListener("click",(e=>{e.preventDefault(),window.localStorage.removeItem("token"),window.localStorage.removeItem("user_display_name"),setFrom("red"),user_display_name.innerHTML="",submit_post_form.classList.add("hidden")})),submit_post.addEventListener("click",(e=>{e.preventDefault(),console.log("Submit clicked");const t={method:"POST",headers:{Authorization:"Bearer "+localStorage.token,"Content-Type":"application/json"},redirect:"follow",body:JSON.stringify({title:post_title.value,excerpt:post_text.value,status:"publish",content:post_content.value})};fetch("https://api.s2010456022.student.kwmhgb.at/wp-json/wp/v2/posts",t).then((e=>201===e.status?(console.error(e),!1):e)).then((e=>{renderPosts([e.json()])}))}));